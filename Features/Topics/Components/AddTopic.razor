@using Microsoft.AspNetCore.Authorization
@using System.Security.Claims
@using TargetBrowse.Features.Topics.Models
@using TargetBrowse.Features.Topics.Services

@attribute [Authorize]

@rendermode InteractiveServer

<div class="card">
    <div class="card-header">
        <h5 class="card-title mb-0">
            Enter A Topic
        </h5>
    </div>
    <div class="card-body">
        <EditForm Model="@TopicModel" OnValidSubmit="@HandleValidSubmit">
            <DataAnnotationsValidator />

            <div class="mb-3">
                <label for="topicName" class="form-label">Topic Name</label>
                <InputText @bind-Value="TopicModel.Name"
                           class="@($"form-control {(ShouldShowPulse() ? "input-pulse-green" : "")}")"
                           id="topicName"
                           placeholder="Enter A Topic"
                           disabled="@IsSubmitting" />
                <ValidationMessage For="@(() => TopicModel.Name)" class="text-danger" />
            </div>

            <div class="mb-3">
                <label for="checkFrequency" class="form-label">Check Frequency</label>
                <div class="dropdown d-grid">
                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle"
                            type="button"
                            data-bs-toggle="dropdown"
                            disabled="@IsSubmitting">
                        <i class="bi bi-clock me-1"></i>
                        @GetCheckFrequencyText(TopicModel.CheckDays)
                    </button>
                    <ul class="dropdown-menu w-100">
                        <li><button class="dropdown-item" type="button" @onclick='() => SetCheckFrequency(3)'>Every 3 days</button></li>
                        <li><button class="dropdown-item" type="button" @onclick='() => SetCheckFrequency(5)'>Every 5 days</button></li>
                        <li><button class="dropdown-item" type="button" @onclick='() => SetCheckFrequency(7)'>Weekly</button></li>
                        <li><button class="dropdown-item" type="button" @onclick='() => SetCheckFrequency(14)'>Bi-Weekly</button></li>
                    </ul>
                </div>
                <ValidationMessage For="@(() => TopicModel.CheckDays)" class="text-danger" />
                <div class="form-text">
                    How often should we check for new content on this topic?
                </div>
            </div>

            <div class="mb-3">
                <button type="submit"
                        class="@($"btn btn-primary w-100 {(ShouldShowPulse() ? "btn-pulse-green" : "")}")"
                        disabled="@IsSubmitting">
                    @if (IsSubmitting)
                    {
                        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    }
                    Add Topic
                </button>
                <div class="form-text mt-2">
                    This will add a Topic to your list and add videos to your suggestions. If you don't want the topic added and just want to search YouTube to add individual vidoes to your library use <a href="video-search">Search Videos</a>.
                </div>
            </div>
        </EditForm>
    </div>
</div>
@using Microsoft.AspNetCore.Authorization
@using System.Security.Claims
@using TargetBrowse.Features.Suggestions.Models
@using TargetBrowse.Features.Suggestions.Services
@using TargetBrowse.Services

<div class="suggestion-actions">
    @if (Mode == ActionMode.Individual)
    {
        <!-- Individual Suggestion Actions -->
        <div class="d-flex gap-2 w-100">
            <button type="button"
                    class="btn btn-primary btn-sm flex-fill"
                    @onclick="ApproveSuggestion"
                    disabled="@IsProcessing"
                    title="Add to library">
                @if (IsProcessing && PendingAction == "approve")
                {
                    <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                }
                else
                {
                    <i class="bi bi-bookmark-plus me-1"></i>
                }
                Library
            </button>

            <button type="button"
                    class="btn btn-outline-danger btn-sm flex-fill"
                    @onclick="DenySuggestion"
                    disabled="@IsProcessing"
                    title="Remove from suggestions">
                @if (IsProcessing && PendingAction == "deny")
                {
                    <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                }
                else
                {
                    <i class="bi bi-hand-thumbs-down me-1"></i>
                }
                Pass
            </button>
        </div>
    }
    else if (Mode == ActionMode.Batch)
    {
        <!-- Batch Actions -->
        <div class="d-flex gap-2 w-100">
            <button type="button"
                    class="btn btn-primary btn-sm flex-fill"
                    @onclick="ApproveSelected"
                    disabled="@(IsProcessing || !SelectedSuggestionIds.Any())"
                    title="Approve selected suggestions">
                @if (IsProcessing && PendingAction == "approve-batch")
                {
                    <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                }
                else
                {
                    <i class="bi bi-bookmark-plus me-1"></i>
                }
                Add to Library (@SelectedSuggestionIds.Count)
            </button>

            <button type="button"
                    class="btn btn-outline-danger btn-sm flex-fill"
                    @onclick="DenySelected"
                    disabled="@(IsProcessing || !SelectedSuggestionIds.Any())"
                    title="Remove selected suggestions">
                @if (IsProcessing && PendingAction == "deny-batch")
                {
                    <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                }
                else
                {
                    <i class="bi bi-hand-thumbs-down me-1"></i>
                }
                Pass and Hide (@SelectedSuggestionIds.Count)
            </button>
        </div>
    }
</div>

<!-- Confirmation Modal for Batch Actions -->
@if (ShowConfirmModal)
{
    <div class="modal fade show" tabindex="-1" style="display: block; background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        @if (ConfirmAction == "approve-batch")
                        {
                            <i class="bi bi-check-circle text-success me-2"></i>
                            @: Approve Multiple Suggestions
                        }
                        else
                        {
                            <i class="bi bi-x-circle text-danger me-2"></i>
                            @: Remove Multiple Suggestions
                        }
                    </h5>
                    <button type="button" class="btn-close" @onclick="CancelConfirmation" disabled="@IsProcessing"></button>
                </div>
                <div class="modal-body">
                    @if (ConfirmAction == "approve-batch")
                    {
                        <p>Are you sure you want to approve <strong>@SelectedSuggestionIds.Count</strong> suggestions?</p>
                        <p class="text-muted small">These videos will be added to your library for later viewing.</p>
                    }
                    else
                    {
                        <p>Are you sure you want to remove <strong>@SelectedSuggestionIds.Count</strong> suggestions?</p>
                        <p class="text-muted small">These suggestions will be removed from your queue and cannot be recovered.</p>
                    }
                </div>
                <div class="modal-footer">
                    <button type="button"
                            class="btn btn-secondary"
                            @onclick="CancelConfirmation"
                            disabled="@IsProcessing">
                        Cancel
                    </button>
                    <button type="button"
                            class="btn @(ConfirmAction == "approve-batch" ? "btn-success" : "btn-danger")"
                            @onclick="ConfirmBatchAction"
                            disabled="@IsProcessing">
                        @if (IsProcessing)
                        {
                            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                        }
                        @(ConfirmAction == "approve-batch" ? "Approve All" : "Remove All")
                    </button>
                </div>
            </div>
        </div>
    </div>
}
@page "/projects"
@using Microsoft.AspNetCore.Authorization
@using TargetBrowse.Features.Projects.Models
@using TargetBrowse.Features.Projects.Components
@attribute [Authorize]
@rendermode InteractiveServer

<PageTitle>My Projects</PageTitle>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>My Projects</h2>
        <button class="btn btn-primary" @onclick="ShowCreateModal" disabled="@IsLoading">
            <i class="bi bi-plus-circle me-2"></i>
            Create New Project
        </button>
    </div>

    @if (IsLoading)
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div class="mt-3 text-muted">Loading your projects...</div>
        </div>
    }
    else if (!string.IsNullOrEmpty(ErrorMessage))
    {
        <div class="alert alert-danger">
            <h5 class="alert-heading">
                <i class="bi bi-exclamation-triangle me-2"></i>
                Error Loading Projects
            </h5>
            <p class="mb-2">@ErrorMessage</p>
            <button class="btn btn-outline-danger btn-sm" @onclick="RetryLoad">
                <i class="bi bi-arrow-clockwise me-1"></i>
                Try Again
            </button>
        </div>
    }
    else if (Projects == null || !Projects.Any())
    {
        <div class="text-center py-5">
            <i class="bi bi-folder-x text-muted" style="font-size: 3rem;"></i>
            <h5 class="mt-3 text-muted">No Projects Yet</h5>
            <p class="text-muted">You haven't created any projects yet. Get started by creating your first project!</p>
            <button class="btn btn-primary mt-3" @onclick="ShowCreateModal">
                <i class="bi bi-plus-circle me-2"></i>
                Create Your First Project
            </button>
        </div>
    }
    else
    {
        <div class="row">
            @foreach (var project in Projects)
            {
                <div class="col-md-6 col-lg-4 mb-4">
                    <ProjectCard Project="@project"
                                 OnEdit="@HandleEdit"
                                 OnDelete="@HandleDelete"
                                 OnView="@HandleView" />
                </div>
            }
        </div>
    }
</div>

@* Modals *@
@if (ShowEditModalState)
{
    <EditProjectModal IsVisible="@ShowEditModalState"
                      Project="@ProjectToEdit"
                      OnSave="@HandleSave"
                      OnCancel="@CloseModals" />
}

@if (ShowDeleteModalState)
{
    <DeleteProjectConfirmation IsVisible="@ShowDeleteModalState"
                                Project="@ProjectToDelete"
                                OnConfirm="@HandleDeleteConfirm"
                                OnCancel="@CloseModals" />
}

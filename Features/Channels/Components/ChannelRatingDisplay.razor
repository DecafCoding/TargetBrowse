@using TargetBrowse.Features.Channels.Models

<!-- Star Display - Always Show 5 Stars -->
<div class="d-flex align-items-center">
    <!-- Clickable Star Display -->
    <div class="me-2" style="cursor: pointer;" @onclick="HandleRatingClick" title="@GetClickTooltip()">
        @for (int i = 1; i <= 5; i++)
        {
            <i class="bi bi-star@(GetStarFill(i)) @GetStarClass(i)"></i>
        }
    </div>

    @if (Rating != null && ShowDetailsButton)
    {
        <!-- View Details Button -->
        <button type="button"
                class="btn btn-outline-secondary btn-sm"
                @onclick="ToggleDetails"
                title="@(ShowDetails ? "Hide rating details" : "Show rating details")">
            <i class="bi bi-@(ShowDetails ? "eye-slash" : "eye")"></i>
        </button>
    }
</div>

@if (Rating != null && ShowDetails && ShowDetailsButton)
{
    <!-- Rating Details -->
    <div class="mt-2 p-2 bg-light rounded">
        <div class="small">
            <div class="d-flex justify-content-between align-items-start mb-1">
                <strong>@Rating.StarDisplayText</strong>
                <small class="text-muted">@Rating.CreatedAtDisplay</small>
            </div>

            @if (!string.IsNullOrWhiteSpace(Rating.Notes))
            {
                <div class="text-muted">
                    @if (ShowFullNotes)
                    {
                        <span>@Rating.Notes</span>
                    }
                    else
                    {
                        <span>@Rating.ShortNotes</span>
                        @if (Rating.Notes.Length > 100)
                        {
                            <button type="button"
                                    class="btn btn-link btn-sm p-0 ms-1"
                                    @onclick="() => ShowFullNotes = true">
                                <small>Show more</small>
                            </button>
                        }
                    }

                    @if (ShowFullNotes && Rating.Notes.Length > 100)
                    {
                        <button type="button"
                                class="btn btn-link btn-sm p-0 ms-1"
                                @onclick="() => ShowFullNotes = false">
                            <small>Show less</small>
                        </button>
                    }
                </div>
            }

            @if (Rating.WasModified)
            {
                <div class="mt-1">
                    <small class="text-muted fst-italic">@Rating.UpdatedAtDisplay</small>
                </div>
            }
        </div>
    </div>
}